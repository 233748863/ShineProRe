# ShinePro 技能循环引擎执行逻辑指南

本文档旨在帮助您理解 ShinePro 引擎如何处理您配置的技能列表，以及如何通过 UI 优化您的技能循环。

## 1. 核心执行逻辑：从上至下的线性扫描

ShinePro 引擎采用 **“优先级线性扫描”** 机制。在每一轮循环（由“全局设置”中的“循环间隔”决定）中，引擎会执行以下操作：

1.  **列表扫描**：引擎从技能列表的 **第 1 项** 开始，依次向下检查。
2.  **条件判定**：对于每一个技能，引擎会检查其是否满足所有释放条件（详见下文）。
3.  **命中执行**：一旦发现某个技能满足所有条件，引擎会立即执行该技能的按键模拟，并 **结束本轮循环**，重新开始下一轮扫描。
4.  **优先级意义**：这意味着排在列表上方的技能拥有绝对的“抢占权”。如果上方技能条件一直满足，下方的技能可能永远不会被触发。

## 2. 技能释放条件判定优先级

对于列表中的每一个技能，引擎按以下顺序进行“三位一体”判定：

### A. 基础数值判定 (HP/MP)
- 检查当前角色的 HP 和 MP 百分比是否高于您设置的最低要求。
- *逻辑：如果血量或蓝量不足，直接跳过该技能。*

### B. 核心视觉检测 (技能图标)
- 引擎会在您框选的“视觉检测区域”内寻找匹配的模板图像。
- *逻辑：只有在屏幕上“看到”该技能（例如技能已冷却完毕、图标变亮）时，才会继续判定。*

### C. 附加视觉要求 (Buff/Debuff)
- 如果您为技能添加了 Buff 要求：
    - **必须满足**：如果勾选，引擎必须在指定区域检测到该 Buff 图像。
    - **是减益 (Debuff)**：通常用于检测怪物身上的状态。
- *逻辑：所有标记为“必须满足”的 Buff 条件都通过后，技能才会最终释放。*

## 3. 如何优化您的技能流程

通过新版 UI，您可以更直观地管理流程：

- **利用序号**：列表左侧的序号（1, 2, 3...）即代表了优先级。
- **排序按钮**：使用“上移”和“下移”按钮来调整优先级。
    - *建议：将“保命技能”或“高伤害长 CD 技能”放在上方；将“基础填充技能”放在下方。*
- **按键预览**：列表右侧显示的按键代码可帮您快速核对是否与游戏内快捷键一致。

## 4. 常见配置案例

### 案例：爆发循环
1.  **序号 1 (大招)**：设置较高的 HP 要求，且必须检测到“爆发 Buff”图标。
2.  **序号 2 (主力技能)**：设置视觉检测区域为技能快捷键位，检测 CD 是否转好。
3.  **序号 3 (平 A/填充)**：不设复杂的视觉要求，作为保底触发。

## 5. 连招 (Combo) 逻辑：以“开花”为例

为了支持复杂的技能组合（如：补 Buff -> 释放主技能 -> 清除 Buff），引擎引入了连招配置功能。

### 执行序列
当引擎决定释放一个带有连招配置的技能时，它会按以下顺序执行：
1. **前置检查**：检查“触发 Buff 名”是否存在。
2. **前置触发**：如果 Buff **缺失**，则先按下“前置技能 (VK)”，并等待“连招延迟”。
3. **主技能释放**：按下主技能按键。
4. **后置清理**：主技能释放成功后，等待“连招延迟”，然后按下“后置技能 (VK)”。

### 配置示例：开花 Combo
- **主技能**：赤芍 (或当归)
- **前置技能 (VK)**：2 (千枝绽蕊的按键代码)
- **触发 Buff 名**：开花 (确保您在 Buff 要求中也配置了名为“开花”的检测项)
- **后置技能 (VK)**：X (取消开花状态的按键代码)
- **连招延迟**：100ms (根据游戏动作响应速度调整)

---
*提示：连招逻辑仅在主技能被选中执行时触发。如果主技能本身因 HP/MP 不足未被选中，连招序列不会启动。*
