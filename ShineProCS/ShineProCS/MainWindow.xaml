<hc:Window x:Class="ShineProCS.MainWindow"
           xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
           xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
           xmlns:hc="https://handyorg.github.io/handycontrol"
           Title="ShinePro - 技能循环引擎" 
           Height="550" Width="850"
           WindowStartupLocation="CenterScreen"
           ShowTitle="True"
           NonClientAreaBackground="{DynamicResource RegionBrush}"
           Background="{DynamicResource RegionBrush}">
    
    <hc:Window.NonClientAreaContent>
        <StackPanel Orientation="Horizontal" Margin="0,0,10,0">
            <TextBlock Text="技能循环引擎" 
                       FontSize="14" 
                       VerticalAlignment="Center"
                       Foreground="{DynamicResource PrimaryTextBrush}"/>
        </StackPanel>
    </hc:Window.NonClientAreaContent>
    
    <hc:Window.Resources>
        <!-- 托盘图标的右键菜单 -->
        <ContextMenu x:Key="TrayMenu">
            <MenuItem Header="显示主窗口" Click="ShowWindow_Click"/>
            <MenuItem Header="隐藏主窗口" Click="HideWindow_Click"/>
            <Separator/>
            <MenuItem Header="启动引擎" Click="StartEngine_Click"/>
            <MenuItem Header="停止引擎" Click="StopEngine_Click"/>
            <Separator/>
            <MenuItem Header="退出程序" Click="ExitApp_Click"/>
        </ContextMenu>
    </hc:Window.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 标题区域 -->
        <hc:SimplePanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="控制面板" 
                       FontSize="28" 
                       FontWeight="Bold"
                       HorizontalAlignment="Center"
                       Foreground="{DynamicResource PrimaryTextBrush}"/>
        </hc:SimplePanel>

        <!-- 状态面板 -->
        <hc:Card Grid.Row="1" 
                 Margin="0,0,0,20"
                 Effect="{StaticResource EffectShadow2}">
            <StackPanel Margin="20">
                <TextBlock Text="{Binding StatusText}" 
                           FontSize="20" 
                           FontWeight="SemiBold"
                           Margin="0,0,0,20"
                           Foreground="{DynamicResource PrimaryBrush}"/>

                <UniformGrid Rows="1" Columns="2">
                    <hc:SimplePanel Margin="0,0,10,0">
                        <Border Background="{DynamicResource SecondaryRegionBrush}"
                                CornerRadius="8"
                                Padding="15">
                            <StackPanel>
                                <TextBlock Text="执行次数" 
                                           FontSize="12" 
                                           Foreground="{DynamicResource SecondaryTextBrush}"
                                           Margin="0,0,0,5"/>
                                <TextBlock Text="{Binding ExecutionCount}" 
                                           FontSize="32" 
                                           FontWeight="Bold"
                                           Foreground="{DynamicResource PrimaryTextBrush}"/>
                            </StackPanel>
                        </Border>
                    </hc:SimplePanel>

                    <hc:SimplePanel Margin="10,0,0,0">
                        <Border Background="{DynamicResource SecondaryRegionBrush}"
                                CornerRadius="8"
                                Padding="15">
                            <StackPanel>
                                <TextBlock Text="平均响应时间" 
                                           FontSize="12" 
                                           Foreground="{DynamicResource SecondaryTextBrush}"
                                           Margin="0,0,0,5"/>
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom">
                                    <TextBlock Text="{Binding AvgResponseTime, StringFormat={}{0:F3}}" 
                                               FontSize="32" 
                                               FontWeight="Bold"
                                               Foreground="{DynamicResource PrimaryTextBrush}"/>
                                    <TextBlock Text=" 秒" 
                                               FontSize="16" 
                                               VerticalAlignment="Bottom"
                                               Margin="5,0,0,5"
                                               Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </hc:SimplePanel>
                </UniformGrid>
            </StackPanel>
        </hc:Card>

        <!-- 控制按钮 -->
        <UniformGrid Grid.Row="2" 
                     Rows="1" 
                     Columns="3"
                     HorizontalAlignment="Center">
            
            <Button Content="启动" 
                    Command="{Binding StartCommand}"
                    IsEnabled="{Binding IsRunning, Converter={StaticResource InverseBooleanConverter}}"
                    Width="150" 
                    Height="45" 
                    Margin="0,0,10,0"
                    FontSize="16"
                    Style="{StaticResource ButtonPrimary}"/>

            <Button Content="暂停" 
                    Command="{Binding PauseCommand}"
                    IsEnabled="{Binding IsRunning}"
                    Width="150" 
                    Height="45" 
                    Margin="5,0,5,0"
                    FontSize="16"
                    Style="{StaticResource ButtonWarning}"/>

            <Button Content="停止" 
                    Command="{Binding StopCommand}"
                    IsEnabled="{Binding IsRunning}"
                    Width="150" 
                    Height="45"
                    Margin="10,0,0,0"
                    FontSize="16"
                    Style="{StaticResource ButtonDanger}"/>
        </UniformGrid>
    </Grid>
</hc:Window>
